<?xml version="1.0" encoding="UTF-8"?>
<project name="JBPatch" default="dist">

	<path id="classpath">
		<fileset dir="lib" includes="**/*.jar" />
	</path>

	<target name="build">
		<delete file="jbpatch.jar" />
		<jar destfile="jbpatch.jar">
			<manifest>
				<attribute name="Bundle-Name" value="JBPatch" />
				<attribute name="Bundle-Version" value="1.0.1" />
				<attribute name="Bundle-Description" value="Kindle Patcher" />
				<attribute name="Bundle-Vendor" value="ixtab" />
				<attribute name="Bundle-Activator" value="com.mobileread.ixtab.jbpatch.bootstrap.Stage1" />
			</manifest>
			<zipfileset src="lib/serp.jar">
				<include name="**/*.class" />
			</zipfileset>
			<fileset dir="bin">
				<include name="com/mobileread/ixtab/jbpatch/**/*" />
			</fileset>
		</jar>
	</target>
	
	<target name="dist" depends="build">
		<move file="jbpatch.jar" todir="dist/src/install" overwrite="true" failonerror="true"/>
		
		<!-- patches referenced from distribution CONFIG.TXT -->
		<copy file="bin/com/mobileread/ixtab/patch/LegalIllegalPatch.class" tofile="dist/opt/jbpatch/ixtab_legal-5.1.0.jbpatch"/>
		<copy file="bin/com/mobileread/ixtab/patch/AllRotationsPatch.class" tofile="dist/opt/jbpatch/ixtab_rotation-5.1.0.jbpatch"/>
		<copy file="bin/com/mobileread/ixtab/patch/ScrollbarPatch.class" tofile="dist/opt/jbpatch/ixtab_scrollbar-5.1.0.jbpatch"/>
		
		<jar destfile="dist/opt/jbpatch/ixtab_tts-5.1.0.zip">
            <manifest>
            	<attribute name="Main-Class" value="com.mobileread.ixtab.patch.tts.TTSPatch"/>
			</manifest>
            <fileset dir="bin">
            	<include name="com/mobileread/ixtab/patch/tts/*.class"/>
        	</fileset>
            <fileset dir="bin/com/mobileread/ixtab/patch/tts">
            	<include name="ttspatch.txt"/>
        	</fileset>
		</jar>
		
		<jar destfile="dist/opt/jbpatch/ixtab_devcertinject-5.1.0.zip">
            <manifest>
            	<attribute name="Main-Class" value="com.mobileread.ixtab.patch.devcert.DevCertInjectPatch"/>
			</manifest>
            <fileset dir="bin">
            	<include name="com/mobileread/ixtab/patch/devcert/*.class"/>
            	<include name="com/mobileread/ixtab/patch/devcert/developer.keystore"/>
        	</fileset>
            <fileset dir="bin/com/mobileread/ixtab/patch/devcert">
            	<include name="ixtab-patch-devcert.txt"/>
        	</fileset>
		</jar>

		<jar destfile="dist/opt/jbpatch/ixtab_passwd-5.1.0.zip">
            <manifest>
            	<attribute name="Main-Class" value="com.mobileread.ixtab.patch.passwd.PasswordPatch"/>
			</manifest>
            <fileset dir="bin">
            	<include name="com/mobileread/ixtab/patch/passwd/*.class"/>
        	</fileset>
            <fileset dir="bin/com/mobileread/ixtab/patch/passwd">
            	<include name="ixtab-patch-passwd.txt"/>
        	</fileset>
		</jar>

	</target>
</project>
